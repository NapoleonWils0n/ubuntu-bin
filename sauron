#!/bin/sh

# external video player script for ytfzf

# input set to args passed to script
input=$(printf "%s\n" "$@")

# mpd and taskspooler
audio() {
    printf "%s\n" "${input}" | \
    while read line
    do
      tsp pinch -i "${line}" 1>/dev/null 
    done
}

# mpv and taskspooler
video() {
    printf "%s\n" "${input}" | \
    while read line
    do
      tsp mpv --no-terminal "${line}" 1>/dev/null
    done
}

# mpv second display and taskspooler
queue() {
    printf "%s\n" "${input}" | \
    while read line
    do
      tsp mpv --fs --screen=1 "${line}" 1>/dev/null 
    done
}

# fzf prompt to specify function to run on links from ytfzf
audio_tsp='audio - mpd queue audio'
video_tsp='video - mpv queue video'
queue_tsp='queue - mpv queue video and play fullscreen on second display'
menu=$(printf "%s\n" "${audio_tsp}" "${video_tsp}" "${queue_tsp}" | fzf --delimiter='\n' --prompt='Open with: ' --info=inline --layout=reverse --no-multi)

# case statement to run function based on fzf prompt output
case "${menu}" in
   audio*) audio;;
   video*) video;;
   queue*) queue;;
   *) exit;;
esac
